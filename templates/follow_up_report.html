<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงูุชูุฑูุฑ ุงูุชุดุฎูุตู - {{ e.full_name }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f4f7f6; font-family: 'Cairo', sans-serif; }
        .report-card { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); margin: 20px auto; max-width: 900px; }
        .report-header { border-bottom: 3px solid #2c3e50; margin-bottom: 30px; padding-bottom: 10px; }
        .section-title { background: #e9ecef; padding: 8px 15px; border-right: 5px solid #2c3e50; margin: 25px 0 15px; font-weight: bold; }
        .data-row { margin-bottom: 10px; display: flex; border-bottom: 1px dashed #ddd; padding: 5px 0; }
        .label { font-weight: bold; width: 250px; color: #555; }
        .editable-area { width: 100%; border: 1px solid #eee; padding: 10px; min-height: 80px; border-radius: 5px; background: #fffcf0; }
        @media print { .no-print { display: none; } .report-card { box-shadow: none; margin: 0; width: 100%; } }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="no-print text-center mb-4">
        <button onclick="window.print()" class="btn btn-primary">๐จ๏ธ ุทุจุงุนุฉ ุงูุชูุฑูุฑ / ุญูุธ PDF</button>
        <button onclick="saveReport()" class="btn btn-success">๐พ ุญูุธ ุงูุชุนุฏููุงุช ุณุญุงุจูุงู</button>
    </div>

    <div class="report-card" id="printableReport">
        <div class="report-header text-center">
            <h2>ุงูุชูุฑูุฑ ุงูุฅููููููู ุงูุดุงูู</h2>
            <p class="text-muted">ูุฑูุฒ Ortho_Psy Tech ููุชูููู ูุงููุชุงุจุนุฉ</p>
        </div>

        <div class="section-title">ุฃ. ูุนูููุงุช ุฃุณุงุณูุฉ</div>
        <div class="data-row"><div class="label">ุงุณู ุงููุฑูุถ / ุงูุทุงูุจ:</div><div>{{ e.full_name }}</div></div>
        <div class="data-row"><div class="label">ุงูุนูุฑ:</div><div>{{ e.age }} ุณููุงุช</div></div>
        <div class="data-row"><div class="label">ุชุงุฑูุฎ ุงููููุงุฏ:</div><div contenteditable="true" class="edit-field" id="birth_date">{{ e.birth_date or 'ูู ูุญุฏุฏ' }}</div></div>
        <div class="data-row"><div class="label">ุณุจุจ ุงูุชูููู:</div><div contenteditable="true" class="edit-field" id="reason">{{ e.reason or 'ุชูููู ุดุงูู' }}</div></div>

        <div class="section-title">ุจ. ุงูุฎูููุฉ ูุงูููุงุญุธุงุช</div>
        <h6>ููุฎุต ุชุทูุฑ ุงููุบุฉ:</h6>
        <div contenteditable="true" class="editable-area" id="language_summary">{{ e.language_summary or 'ุฃุฏุฎู ุงูููุฎุต ููุง...' }}</div>
        
        <h6 class="mt-3">ุงูุชุงุฑูุฎ ุงูุตุญู (ุญุณุงุณูุฉุ ุณูุนุ ุฑุคูุฉ):</h6>
        <div contenteditable="true" class="editable-area" id="health_history">{{ e.health_history or 'ูุง ููุฌุฏ ูุดููุงุช ุตุญูุฉ ูุนุฑููุฉ' }}</div>

        <div class="section-title">ุฌ. ูุชุงุฆุฌ ุงูุชูููู</div>
        <h6>ุงูููุงุณุงุช ุงูุฑุณููุฉ (ุงุฎุชุจุงุฑุงุช ูุนูุงุฑูุฉ):</h6>
        <div contenteditable="true" class="editable-area" id="tests_results">{{ e.tests_results or 'ุฃุฏุฎู ูุชุงุฆุฌ ุงูููุงููุณ...' }}</div>

        <h6 class="mt-3">ุชุญููู ุงูููุงุฑุงุช:</h6>
        <div class="row">
            <div class="col-md-6">
                <small>โข ุงูููู ูุงูุงุณุชูุนุงุจ:</small>
                <div contenteditable="true" class="editable-area mb-2" id="skill_comprehension"></div>
                <small>โข ุงูุชุนุจูุฑ:</small>
                <div contenteditable="true" class="editable-area mb-2" id="skill_expression"></div>
            </div>
            <div class="col-md-6">
                <small>โข ุงููุทู ูุงูููููููุฌูุง:</small>
                <div contenteditable="true" class="editable-area mb-2" id="skill_phonology"></div>
                <small>โข ุงูุณููู ุงูุชูุงุตูู:</small>
                <div contenteditable="true" class="editable-area mb-2" id="skill_behavior"></div>
            </div>
        </div>

        <div class="section-title">ุฏ. ุงูุฃูุฏุงู ุงูุนูุงุฌูุฉ ูุงูุชูุตูุงุช</div>
        <h6>ุฃูุฏุงู ูุตูุฑุฉ ูุทูููุฉ ุงููุฏู:</h6>
        <div contenteditable="true" class="editable-area" id="goals">{{ e.goals or '1. \n2.' }}</div>

        <h6 class="mt-3">ุฎุทุฉ ุงูุชุฏุฎู ูุฏุนู ุงูุฃูู:</h6>
        <div contenteditable="true" class="editable-area" id="intervention_plan">{{ e.intervention_plan or 'ุชูุตูุงุช ููููุฒู ูุงููุฏุฑุณุฉ...' }}</div>
    </div>
</div>

<script>
    function saveReport() {
        const data = {
            id: "{{ e.id }}",
            birth_date: document.getElementById('birth_date').innerText,
            language_summary: document.getElementById('language_summary').innerText,
            health_history: document.getElementById('health_history').innerText,
            tests_results: document.getElementById('tests_results').innerText,
            goals: document.getElementById('goals').innerText,
            intervention_plan: document.getElementById('intervention_plan').innerText
            // ุฃุถู ุงูุจููุฉ ููุง
        };

        fetch('/save_full_report', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(res => res.json()).then(res => {
            if(res.success) alert('ุชู ุญูุธ ุงูุชูุฑูุฑ ูู ุงูุณุญุงุจุฉ ุจูุฌุงุญ โ');
        });
    }
</script>
</body>
</html>
